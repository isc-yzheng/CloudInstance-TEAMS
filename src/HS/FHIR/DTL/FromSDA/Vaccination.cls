Class HS.FHIR.DTL.FromSDA.Vaccination Extends Ens.DataTransformDTL [ DependsOn = (HS.SDA3.Medication, HS.FHIR.vDSTU2.Model.Resource.MedicationOrder) ]
{

Parameter IGNOREMISSINGSOURCE = 1;

Parameter REPORTERRORS = 1;

Parameter TREATEMPTYREPEATINGFIELDASNULL = 0;

XData DTL [ XMLNamespace = "http://www.intersystems.com/dtl" ]
{
<transform sourceClass='HS.SDA3.Vaccination' targetClass='HS.FHIR.vDSTU2.Model.Resource.Immunization' create='new' language='objectscript' >
<annotation>This transform uses the reserved DTL input parameter named &#39;aux&#39;.
For this transform, aux is a local array of strings.  The values held in aux were generated by the SDA to FHIR DTL framework prior to calling into this transform.
aux("ResourceId"): FHIR resource id to assign to the resource being created by this transform.
aux("PatientResourceId"): FHIR resource id for the patient represented by the Patient object in the SDA Container being transformed.
aux("EncounterResourceIds", sda_encounter_number) = FHIR resource id for the Encounters from the SDA Container.</annotation>
<assign value='$G(aux("ResourceId"))' property='target.id.value' action='set' />
<code>
<![CDATA[ set iIdentifier=1]]></code>
<if condition='source.ExternalId &apos;= ""' >
<true>
<assign value='"official"' property='target.identifier.(iIdentifier).use.value' action='set' />
<assign value='"ExternalId"' property='target.identifier.(iIdentifier).type.text.value' action='set' />
<assign value='source.ExternalId' property='target.identifier.(iIdentifier).value.value' action='set' />
<code>
<![CDATA[ set iIdentifier=iIdentifier + 1]]></code>
</true>
</if>
<if condition='source.PlacerId &apos;=""' >
<true>
<assign value='"official"' property='target.identifier.(iIdentifier).use.value' action='set' />
<assign value='"http://hl7.org/fhir/identifier-type"' property='target.identifier.(iIdentifier).type.coding.(1).system.value' action='set' />
<assign value='"PLAC"' property='target.identifier.(iIdentifier).type.coding.(1).code.value' action='set' />
<assign value='"Placer Identifier"' property='target.identifier.(iIdentifier).type.coding.(1).display.value' action='set' />
<assign value='source.PlacerId' property='target.identifier.(iIdentifier).value.value' action='set' />
<assign value='"PlacerId"' property='target.identifier.(iIdentifier).type.text.value' action='set' />
<code>
<![CDATA[ set iIdentifier=iIdentifier + 1]]></code>
</true>
</if>
<if condition='source.FillerId &apos;= ""' >
<true>
<assign value='"official"' property='target.identifier.(iIdentifier).use.value' action='set' />
<assign value='"http://hl7.org/fhir/identifier-type"' property='target.identifier.(iIdentifier).type.coding.(1).system.value' action='set' />
<assign value='"FILL"' property='target.identifier.(iIdentifier).type.coding.(1).code.value' action='set' />
<assign value='"Filler Identifier"' property='target.identifier.(iIdentifier).type.coding.(1).display.value' action='set' />
<assign value='source.FillerId' property='target.identifier.(iIdentifier).value.value' action='set' />
<assign value='"FillerId"' property='target.identifier.(iIdentifier).type.text.value' action='set' />
<code>
<![CDATA[ set iIdentifier=iIdentifier + 1]]></code>
</true>
</if>
<assign value='##class(HS.FHIR.DTL.Utils).LookupFHIR("FromSDAVaccinationStatus",source.Status,"completed",3)' property='target.status.value' action='set' />
<subtransform class='HS.FHIR.DTL.FromSDA.SubTransform.CodeTableTranslated' sourceObj='source.OrderItem' targetObj='target.vaccineCode' />
<subtransform class='HS.FHIR.DTL.FromSDA.SubTransform.PatientReference' targetObj='target.patient' sourceObj='target' aux='.aux' />
<assign value='"false"' property='target.wasNotGiven.value' action='set' />
<assign value='"false"' property='target.reported.value' action='set' />
<assign value='##class(HS.FHIR.DTL.Utils).FHIRDateTime(source.EnteredOn)' property='target.date.value' action='set' />
<if condition='##class(HS.FHIR.DTL.Utils).CPIsDefined(source,"OrderedBy")' >
<true>
<assign value='source.OrderedBy.Name.GivenName_" "_source.OrderedBy.Name.FamilyName' property='target.requester.display.value' action='set' />
<assign value='"#"_source.OrderedBy.InternalReference ' property='target.requester.reference.value' action='set' />
<subtransform class='HS.FHIR.DTL.FromSDA.SubTransform.CareProvider' targetObj='target.contained.(1).Practitioner' sourceObj='source.OrderedBy' />
</true>
</if>
<if condition='(source.EncounterNumber &apos;= "") &amp;&amp; ($G(aux("EncounterResourceIds",source.EncounterNumber)) &apos;= "")' >
<true>
<assign value='"Encounter/"_aux("EncounterResourceIds",source.EncounterNumber)' property='target.encounter.reference.value' action='set' />
<assign value='source.EncounterNumber' property='target.encounter.display.value' action='set' />
</true>
</if>
<if condition='source.Comments &apos;= ""' >
<true>
<assign value='source.Comments' property='target.note.(1).text.value' action='set' />
</true>
</if>
<if condition='source.Indication &apos;= ""' >
<true>
<assign value='source.Indication' property='target.explanation.reason.(1).text.value' action='set' />
</true>
</if>
<subtransform class='HS.FHIR.DTL.FromSDA.SubTransform.CodeTableTranslated' sourceObj='source.Route' targetObj='target.route' />
<assign value='source.DoseQuantity' property='target.doseQuantity.value.value' action='set' />
<foreach property='source.DosageSteps()' key='k1' >
<subtransform class='HS.FHIR.DTL.FromSDA.SubTransform.CodeTableTranslated' sourceObj='source.Route' targetObj='target.dosageInstruction.(k1).route' />
<assign value='source.DosageSteps.(k1).DoseQuantity' property='target.doseQuantity.value.value' action='set' />
</foreach>
</transform>
}

}
